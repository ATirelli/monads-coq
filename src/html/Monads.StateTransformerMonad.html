<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">Monads.StateTransformerMonad</h1>

<div class="code">
</div>

<div class="doc">
<a id="lab10"></a><h1 class="section">The state transformer monad</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Numbers.Natural.Peano.NPeano.html#"><span class="id" title="library">NPeano</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Arith.Arith.html#"><span class="id" title="library">Arith</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Bool.Bool.html#"><span class="id" title="library">Bool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Strings.String.html#"><span class="id" title="library">String</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Logic.FunctionalExtensionality.html#"><span class="id" title="library">Coq.Logic.FunctionalExtensionality</span></a>.<br/>

<br/>
<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="Monad" class="idref" href="#Monad"><span class="id" title="record">Monad</span></a>(<a id="M:1" class="idref" href="#M:1"><span class="id" title="binder">M</span></a>:<span class="id" title="keyword">Type</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="id" title="keyword">Type</span>) := <br/>
{<br/>
&nbsp;&nbsp;<a id="ret" class="idref" href="#ret"><span class="id" title="projection">ret</span></a> : <span class="id" title="keyword">forall</span> {<a id="A:3" class="idref" href="#A:3"><span class="id" title="binder">A</span></a>:<span class="id" title="keyword">Type</span>}, <a class="idref" href="Monads.StateTransformerMonad.html#A:3"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#M:1"><span class="id" title="variable">M</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#A:3"><span class="id" title="variable">A</span></a> ; <br/>
&nbsp;&nbsp;<a id="bind" class="idref" href="#bind"><span class="id" title="projection">bind</span></a> : <span class="id" title="keyword">forall</span> {<a id="A:5" class="idref" href="#A:5"><span class="id" title="binder">A</span></a> <a id="B:6" class="idref" href="#B:6"><span class="id" title="binder">B</span></a>:<span class="id" title="keyword">Type</span>}, <a class="idref" href="Monads.StateTransformerMonad.html#M:1"><span class="id" title="variable">M</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#A:5"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Monads.StateTransformerMonad.html#A:5"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#M:1"><span class="id" title="variable">M</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#B:6"><span class="id" title="variable">B</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#M:1"><span class="id" title="variable">M</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#B:6"><span class="id" title="variable">B</span></a><br/>
}.<br/>

<br/>
<span class="id" title="keyword">Notation</span> <a id="f4c072b7f26484005a9e0c3986ed1f19" class="idref" href="#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">&quot;</span></a>x &lt;- c1 ;; c2" := (<a class="idref" href="Monads.StateTransformerMonad.html#bind"><span class="id" title="method">bind</span></a> <span class="id" title="var">c1</span> (<span class="id" title="keyword">fun</span> <a id="x:8" class="idref" href="#x:8"><span class="id" title="binder">x</span></a> =&gt; <span class="id" title="var">c2</span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 84, <span class="id" title="var">c1</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>).<br/>

<br/>
<span class="id" title="keyword">Notation</span> <a id="ddfa557d890d9c0cd173d40cb7db80da" class="idref" href="#ddfa557d890d9c0cd173d40cb7db80da"><span class="id" title="notation">&quot;</span></a>c1 ;; c2" := (<a class="idref" href="Monads.StateTransformerMonad.html#bind"><span class="id" title="method">bind</span></a> <span class="id" title="var">c1</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">c2</span>)) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 100, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
<span class="id" title="keyword">Axiom</span> <a id="functional_extensionality" class="idref" href="#functional_extensionality"><span class="id" title="axiom">functional_extensionality</span></a> : <span class="id" title="keyword">forall</span> {<a id="X:9" class="idref" href="#X:9"><span class="id" title="binder">X</span></a> <a id="Y:10" class="idref" href="#Y:10"><span class="id" title="binder">Y</span></a>: <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<a id="f:11" class="idref" href="#f:11"><span class="id" title="binder">f</span></a> <a id="g:12" class="idref" href="#g:12"><span class="id" title="binder">g</span></a> : <a class="idref" href="Monads.StateTransformerMonad.html#X:9"><span class="id" title="variable">X</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#Y:10"><span class="id" title="variable">Y</span></a>},<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> (<a id="x:13" class="idref" href="#x:13"><span class="id" title="binder">x</span></a>:<a class="idref" href="Monads.StateTransformerMonad.html#X:9"><span class="id" title="variable">X</span></a>), <a class="idref" href="Monads.StateTransformerMonad.html#f:11"><span class="id" title="variable">f</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#x:13"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#g:12"><span class="id" title="variable">g</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#x:13"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#f:11"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#g:12"><span class="id" title="variable">g</span></a>.<br/>

<br/>
</div>

<div class="doc">
We now use a more refined definition for <span class="inlinecode"><a class="idref" href="Monads.StateTransformerMonad.html#state"><span class="id" title="definition">state</span></a></span>: it is no more just an integer accounting for the 
total number of computations needed to evaluate a term, but a <span class="inlinecode"><a class="idref" href="Monads.FunctorApplicativeMonad.html#map"><span class="id" title="projection">map</span></a></span> from <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a></span> to <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a></span>. 
<div class="paragraph"> </div>

 <span class="inlinecode"></span> 
<span class="inlinecode"></span>
From Walder's paper we read: 

<div class="paragraph"> </div>

<i>There is an important difference between the way monads are used in 
the previous section and the way monads are used here. 
The previous section showed monads help to use existing language 
features more effectively; this section shows how monads can help define new language features. 
No change to the program- ming language is required, but the implementation must provide a 
new abstract data type, perhaps as part of the standard prelude.
Here monads are used to manipulate state internal to the program</i>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="state" class="idref" href="#state"><span class="id" title="definition">state</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="newarray" class="idref" href="#newarray"><span class="id" title="definition">newarray</span></a> (<a id="n:15" class="idref" href="#n:15"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="Monads.StateTransformerMonad.html#state"><span class="id" title="definition">state</span></a> :=<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="Monads.StateTransformerMonad.html#n:15"><span class="id" title="variable">n</span></a>).<br/>

<br/>
<span class="id" title="keyword">Notation</span> <a id="b26b31fedd72ecba0f79904d3f161f8b" class="idref" href="#b26b31fedd72ecba0f79904d3f161f8b"><span class="id" title="notation">&quot;</span></a>'_' '!-&gt;' v" := (<a class="idref" href="Monads.StateTransformerMonad.html#newarray"><span class="id" title="definition">newarray</span></a> <span class="id" title="var">v</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 100, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="eqb_string" class="idref" href="#eqb_string"><span class="id" title="definition">eqb_string</span></a> (<a id="x:16" class="idref" href="#x:16"><span class="id" title="binder">x</span></a> <a id="y:17" class="idref" href="#y:17"><span class="id" title="binder">y</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Strings.String.html#string_dec"><span class="id" title="definition">string_dec</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#x:16"><span class="id" title="variable">x</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#y:17"><span class="id" title="variable">y</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="state_update" class="idref" href="#state_update"><span class="id" title="definition">state_update</span></a>  (<a id="m:18" class="idref" href="#m:18"><span class="id" title="binder">m</span></a> : <a class="idref" href="Monads.StateTransformerMonad.html#state"><span class="id" title="definition">state</span></a> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="x:19" class="idref" href="#x:19"><span class="id" title="binder">x</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) (<a id="v:20" class="idref" href="#v:20"><span class="id" title="binder">v</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="x':21" class="idref" href="#x':21"><span class="id" title="binder">x'</span></a> =&gt; <span class="id" title="keyword">if</span> <a class="idref" href="Monads.StateTransformerMonad.html#eqb_string"><span class="id" title="definition">eqb_string</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#x:19"><span class="id" title="variable">x</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#x':21"><span class="id" title="variable">x'</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Monads.StateTransformerMonad.html#v:20"><span class="id" title="variable">v</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Monads.StateTransformerMonad.html#m:18"><span class="id" title="variable">m</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#x':21"><span class="id" title="variable">x'</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="empty_st" class="idref" href="#empty_st"><span class="id" title="definition">empty_st</span></a> := (<a class="idref" href="Monads.StateTransformerMonad.html#b26b31fedd72ecba0f79904d3f161f8b"><span class="id" title="notation">_</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#b26b31fedd72ecba0f79904d3f161f8b"><span class="id" title="notation">!-&gt;</span></a> 0).<br/>

<br/>
</div>

<div class="doc">
It will also be useful to consider the <span class="inlinecode"><span class="id" title="keyword">type</span></span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a></span>, which has the property of having only one 
inhabitant. To mimic Walder's notation, we shall denote such an inhabitant with <span class="inlinecode">()</span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Notation</span> <a id="f5cb26d96fc0400fc3c881290947e554" class="idref" href="#f5cb26d96fc0400fc3c881290947e554"><span class="id" title="notation">&quot;</span></a>()" := <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a>.<br/>

<br/>
</div>

<div class="doc">
As for the <span class="inlinecode"><a class="idref" href="Monads.StateTransformerMonad.html#StateMonad"><span class="id" title="instance">StateMonad</span></a></span> seen earlier, we define the <span class="inlinecode"><a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a></span> function, which, given a type <span class="inlinecode"><span class="id" title="var">A</span></span>, 
constructs a new type <span class="inlinecode"><a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a></span> <span class="inlinecode"><span class="id" title="var">A</span></span>, which is a map <span class="inlinecode"><a class="idref" href="Monads.StateTransformerMonad.html#state"><span class="id" title="definition">state</span></a></span> <span class="inlinecode">-&gt;</span> <span class="inlinecode">(<span class="id" title="var">A</span>*<a class="idref" href="Monads.StateTransformerMonad.html#state"><span class="id" title="definition">state</span></a>)</span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="state_comp" class="idref" href="#state_comp"><span class="id" title="definition">state_comp</span></a>(<a id="A:22" class="idref" href="#A:22"><span class="id" title="binder">A</span></a>:<span class="id" title="keyword">Type</span>) := <a class="idref" href="Monads.StateTransformerMonad.html#state"><span class="id" title="definition">state</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Monads.StateTransformerMonad.html#A:22"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">*</span></a><a class="idref" href="Monads.StateTransformerMonad.html#state"><span class="id" title="definition">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
The definition below is identical to the one we have already seen, but where <span class="inlinecode"><a class="idref" href="Monads.StateTransformerMonad.html#state"><span class="id" title="definition">state</span></a></span> is not just a <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a></span>. 
A such, the statements and the corresponding proofs of the monad properties can be copied verbatim. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Instance</span> <a id="StateMonad" class="idref" href="#StateMonad"><span class="id" title="instance">StateMonad</span></a> : <a class="idref" href="Monads.StateTransformerMonad.html#Monad"><span class="id" title="class">Monad</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a> := {<br/>
&nbsp;&nbsp;<a class="idref" href="Monads.StateTransformerMonad.html#ret"><span class="id" title="method">ret</span></a> := <span class="id" title="keyword">fun</span> {<a id="A:23" class="idref" href="#A:23"><span class="id" title="binder">A</span></a>:<span class="id" title="keyword">Type</span>} (<a id="x:24" class="idref" href="#x:24"><span class="id" title="binder">x</span></a>:<a class="idref" href="Monads.StateTransformerMonad.html#A:23"><span class="id" title="variable">A</span></a>) =&gt; (<span class="id" title="keyword">fun</span> (<a id="s:25" class="idref" href="#s:25"><span class="id" title="binder">s</span></a>:<a class="idref" href="Monads.StateTransformerMonad.html#state"><span class="id" title="definition">state</span></a>) =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Monads.StateTransformerMonad.html#x:24"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#s:25"><span class="id" title="variable">s</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) ; <br/>
&nbsp;&nbsp;<a class="idref" href="Monads.StateTransformerMonad.html#bind"><span class="id" title="method">bind</span></a> := <span class="id" title="keyword">fun</span> {<a id="A:26" class="idref" href="#A:26"><span class="id" title="binder">A</span></a> <a id="B:27" class="idref" href="#B:27"><span class="id" title="binder">B</span></a>:<span class="id" title="keyword">Type</span>} (<a id="c:28" class="idref" href="#c:28"><span class="id" title="binder">c</span></a> : <a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#A:26"><span class="id" title="variable">A</span></a>) (<a id="f:29" class="idref" href="#f:29"><span class="id" title="binder">f</span></a>: <a class="idref" href="Monads.StateTransformerMonad.html#A:26"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#B:27"><span class="id" title="variable">B</span></a>) =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<a id="s:30" class="idref" href="#s:30"><span class="id" title="binder">s</span></a>:<a class="idref" href="Monads.StateTransformerMonad.html#state"><span class="id" title="definition">state</span></a>) =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="v:31" class="idref" href="#v:31"><span class="id" title="binder">v</span></a>, <a id="s':32" class="idref" href="#s':32"><span class="id" title="binder">s'</span></a>) := <a class="idref" href="Monads.StateTransformerMonad.html#c:28"><span class="id" title="variable">c</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#s:30"><span class="id" title="variable">s</span></a> <span class="id" title="tactic">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Monads.StateTransformerMonad.html#f:29"><span class="id" title="variable">f</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#v:31"><span class="id" title="variable">v</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#s':32"><span class="id" title="variable">s'</span></a><br/>
}.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="m_left_id_state_monad" class="idref" href="#m_left_id_state_monad"><span class="id" title="lemma">m_left_id_state_monad</span></a> : <span class="id" title="keyword">forall</span> {<a id="A:33" class="idref" href="#A:33"><span class="id" title="binder">A</span></a> <a id="B:34" class="idref" href="#B:34"><span class="id" title="binder">B</span></a>:<span class="id" title="keyword">Type</span>} (<a id="x:35" class="idref" href="#x:35"><span class="id" title="binder">x</span></a>:<a class="idref" href="Monads.StateTransformerMonad.html#A:33"><span class="id" title="variable">A</span></a>) (<a id="f:36" class="idref" href="#f:36"><span class="id" title="binder">f</span></a>:<a class="idref" href="Monads.StateTransformerMonad.html#A:33"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#B:34"><span class="id" title="variable">B</span></a>), <a class="idref" href="Monads.StateTransformerMonad.html#bind"><span class="id" title="method">bind</span></a> (<a class="idref" href="Monads.StateTransformerMonad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#x:35"><span class="id" title="variable">x</span></a>) <a class="idref" href="Monads.StateTransformerMonad.html#f:36"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#f:36"><span class="id" title="variable">f</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#x:35"><span class="id" title="variable">x</span></a> .<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Monads.StateTransformerMonad.html#functional_extensionality"><span class="id" title="axiom">functional_extensionality</span></a>. <span class="id" title="tactic">trivial</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="m_right_id_state_monad" class="idref" href="#m_right_id_state_monad"><span class="id" title="lemma">m_right_id_state_monad</span></a> : <span class="id" title="keyword">forall</span> {<a id="A:37" class="idref" href="#A:37"><span class="id" title="binder">A</span></a> <a id="B:38" class="idref" href="#B:38"><span class="id" title="binder">B</span></a>:<span class="id" title="keyword">Type</span>} (<a id="c:39" class="idref" href="#c:39"><span class="id" title="binder">c</span></a>:<a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#A:37"><span class="id" title="variable">A</span></a>), <a class="idref" href="Monads.StateTransformerMonad.html#bind"><span class="id" title="method">bind</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#c:39"><span class="id" title="variable">c</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#c:39"><span class="id" title="variable">c</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Monads.StateTransformerMonad.html#functional_extensionality"><span class="id" title="axiom">functional_extensionality</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span>. <span class="id" title="tactic">trivial</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="m_assoc_state_monad" class="idref" href="#m_assoc_state_monad"><span class="id" title="lemma">m_assoc_state_monad</span></a> : <span class="id" title="keyword">forall</span> {<a id="A:40" class="idref" href="#A:40"><span class="id" title="binder">A</span></a> <a id="B:41" class="idref" href="#B:41"><span class="id" title="binder">B</span></a> <a id="C:42" class="idref" href="#C:42"><span class="id" title="binder">C</span></a>} (<a id="c:43" class="idref" href="#c:43"><span class="id" title="binder">c</span></a>:<a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#A:40"><span class="id" title="variable">A</span></a>) (<a id="f:44" class="idref" href="#f:44"><span class="id" title="binder">f</span></a>:<a class="idref" href="Monads.StateTransformerMonad.html#A:40"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#B:41"><span class="id" title="variable">B</span></a>) (<a id="g:45" class="idref" href="#g:45"><span class="id" title="binder">g</span></a>:<a class="idref" href="Monads.StateTransformerMonad.html#B:41"><span class="id" title="variable">B</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#C:42"><span class="id" title="variable">C</span></a>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Monads.StateTransformerMonad.html#bind"><span class="id" title="method">bind</span></a> (<a class="idref" href="Monads.StateTransformerMonad.html#bind"><span class="id" title="method">bind</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#c:43"><span class="id" title="variable">c</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#f:44"><span class="id" title="variable">f</span></a>) <a class="idref" href="Monads.StateTransformerMonad.html#g:45"><span class="id" title="variable">g</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#bind"><span class="id" title="method">bind</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#c:43"><span class="id" title="variable">c</span></a> (<span class="id" title="keyword">fun</span> <a id="x:46" class="idref" href="#x:46"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="Monads.StateTransformerMonad.html#bind"><span class="id" title="method">bind</span></a> (<a class="idref" href="Monads.StateTransformerMonad.html#f:44"><span class="id" title="variable">f</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#x:46"><span class="id" title="variable">x</span></a>) <a class="idref" href="Monads.StateTransformerMonad.html#g:45"><span class="id" title="variable">g</span></a>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Monads.StateTransformerMonad.html#functional_extensionality"><span class="id" title="axiom">functional_extensionality</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">c</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">trivial</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">

<div class="paragraph"> </div>

You might argue that building all this for the simple term language we have used to far as running
example is an overkill and might not even make sense. You are right: we something a bit more sophisticated. 
For this purpose, we are going to use a simplified version of <span class="inlinecode"><span class="id" title="var">IMP</span></span>, the simple imperative language we have 
been working on in the <i>Formal Methods</i> course. We want to complicate things, but not too much: we therefore 
limit ourselves to considering expression which are: 
<ul class="doclist">
<li> natural numbers 

</li>
<li> variable IDs

</li>
<li> sum of expressions 

</li>
<li> equations between expressions. 

</li>
</ul>
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a id="exp" class="idref" href="#exp"><span class="id" title="inductive">exp</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a id="ANum" class="idref" href="#ANum"><span class="id" title="constructor">ANum</span></a> (<a id="n:49" class="idref" href="#n:49"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;| <a id="AId" class="idref" href="#AId"><span class="id" title="constructor">AId</span></a> (<a id="x:50" class="idref" href="#x:50"><span class="id" title="binder">x</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>)             <br/>
&nbsp;&nbsp;| <a id="APlus" class="idref" href="#APlus"><span class="id" title="constructor">APlus</span></a> (<a id="a1:51" class="idref" href="#a1:51"><span class="id" title="binder">a1</span></a> <a id="a2:52" class="idref" href="#a2:52"><span class="id" title="binder">a2</span></a> : <a class="idref" href="Monads.StateTransformerMonad.html#exp:47"><span class="id" title="inductive">exp</span></a>)<br/>
&nbsp;&nbsp;| <a id="EqExp" class="idref" href="#EqExp"><span class="id" title="constructor">EqExp</span></a> (<a id="a1:53" class="idref" href="#a1:53"><span class="id" title="binder">a1</span></a> <a id="a2:54" class="idref" href="#a2:54"><span class="id" title="binder">a2</span></a>: <a class="idref" href="Monads.StateTransformerMonad.html#exp:47"><span class="id" title="inductive">exp</span></a>).<br/>

<br/>
<span class="id" title="keyword">Coercion</span> <a class="idref" href="Monads.StateTransformerMonad.html#AId"><span class="id" title="constructor">AId</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#AId"><span class="id" title="constructor">:</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#AId"><span class="id" title="constructor">string</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#AId"><span class="id" title="constructor">&gt;-&gt;</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#AId"><span class="id" title="constructor">exp</span></a>.<br/>
<span class="id" title="keyword">Coercion</span> <a class="idref" href="Monads.StateTransformerMonad.html#ANum"><span class="id" title="constructor">ANum</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#ANum"><span class="id" title="constructor">:</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#ANum"><span class="id" title="constructor">nat</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#ANum"><span class="id" title="constructor">&gt;-&gt;</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#ANum"><span class="id" title="constructor">exp</span></a>.<br/>

<br/>
<span class="id" title="var">Declare</span> <span class="id" title="var">Custom</span> <span class="id" title="var">Entry</span> <span class="id" title="var">com</span>.<br/>
<span class="id" title="var">Declare</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">com_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> <a id="23430cd9e427d30c054d4f029e39cb7f" class="idref" href="#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">&quot;</span></a>&lt;{ e }&gt;" := <span class="id" title="var">e</span> (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">e</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99) : <span class="id" title="var">com_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> <a id="5a96623d056c293ebbcdf03005796e09" class="idref" href="#5a96623d056c293ebbcdf03005796e09"><span class="id" title="notation">&quot;</span></a>( x )" := <span class="id" title="var">x</span> (<span class="id" title="tactic">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span>, <span class="id" title="var">x</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99) : <span class="id" title="var">com_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> <a id=":com:com_scope:x" class="idref" href="#:com:com_scope:x"><span class="id" title="notation">&quot;</span></a>x" := <span class="id" title="var">x</span> (<span class="id" title="tactic">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">x</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0) : <span class="id" title="var">com_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> <a id=":com:com_scope:x_x_'..'_x" class="idref" href="#:com:com_scope:x_x_'..'_x"><span class="id" title="notation">&quot;</span></a>f x .. y" := (.. (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) .. <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">parsing</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">f</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">x</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">y</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9) : <span class="id" title="var">com_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> <a id="ad27fd091d9c8494ce7e5135135d19a8" class="idref" href="#ad27fd091d9c8494ce7e5135135d19a8"><span class="id" title="notation">&quot;</span></a>x + y" := (<a class="idref" href="Monads.StateTransformerMonad.html#APlus"><span class="id" title="constructor">APlus</span></a> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) (<span class="id" title="tactic">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 50, <span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>).<br/>
<span class="id" title="keyword">Notation</span> <a id="ce85550d97cec68f8ef10237cdcbffd3" class="idref" href="#ce85550d97cec68f8ef10237cdcbffd3"><span class="id" title="notation">&quot;</span></a>x == y" := (<a class="idref" href="Monads.StateTransformerMonad.html#EqExp"><span class="id" title="constructor">EqExp</span></a> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) (<span class="id" title="tactic">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 50, <span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>).<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">com_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="X" class="idref" href="#X"><span class="id" title="definition">X</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>:="x"%<span class="id" title="var">string</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="Y" class="idref" href="#Y"><span class="id" title="definition">Y</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>:="y"%<span class="id" title="var">string</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="Z" class="idref" href="#Z"><span class="id" title="definition">Z</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>:="z"%<span class="id" title="var">string</span>.<br/>

<br/>
</div>

<div class="doc">
As far as commands go, we consider: 
<ul class="doclist">
<li> the "skip" command, which performs no action

</li>
<li> the assignment command, which assigns an expression to a variable

</li>
<li> the sequence of two commands

</li>
<li> the <span class="inlinecode"><span class="id" title="var">If</span></span> statement.

</li>
</ul>

<div class="paragraph"> </div>


</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a id="com" class="idref" href="#com"><span class="id" title="inductive">com</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a id="CSkip" class="idref" href="#CSkip"><span class="id" title="constructor">CSkip</span></a> <br/>
&nbsp;&nbsp;| <a id="CAss" class="idref" href="#CAss"><span class="id" title="constructor">CAss</span></a> (<a id="x:57" class="idref" href="#x:57"><span class="id" title="binder">x</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) (<a id="a:58" class="idref" href="#a:58"><span class="id" title="binder">a</span></a> : <a class="idref" href="Monads.StateTransformerMonad.html#exp"><span class="id" title="inductive">exp</span></a>)<br/>
&nbsp;&nbsp;| <a id="CSeq" class="idref" href="#CSeq"><span class="id" title="constructor">CSeq</span></a> (<a id="c1:59" class="idref" href="#c1:59"><span class="id" title="binder">c1</span></a> <a id="c2:60" class="idref" href="#c2:60"><span class="id" title="binder">c2</span></a> : <a class="idref" href="Monads.StateTransformerMonad.html#com:55"><span class="id" title="inductive">com</span></a>)<br/>
&nbsp;&nbsp;| <a id="CIf" class="idref" href="#CIf"><span class="id" title="constructor">CIf</span></a> (<a id="a:61" class="idref" href="#a:61"><span class="id" title="binder">a</span></a>: <a class="idref" href="Monads.StateTransformerMonad.html#exp"><span class="id" title="inductive">exp</span></a>) (<a id="c1:62" class="idref" href="#c1:62"><span class="id" title="binder">c1</span></a> <a id="c2:63" class="idref" href="#c2:63"><span class="id" title="binder">c2</span></a> : <a class="idref" href="Monads.StateTransformerMonad.html#com:55"><span class="id" title="inductive">com</span></a>).<br/>

<br/>
<span class="id" title="keyword">Notation</span> <a id=":com:com_scope:'skip'" class="idref" href="#:com:com_scope:'skip'"><span class="id" title="notation">&quot;</span></a>'skip'"  :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Monads.StateTransformerMonad.html#CSkip"><span class="id" title="constructor">CSkip</span></a> (<span class="id" title="tactic">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0) : <span class="id" title="var">com_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> <a id="91e9aa710642047a93142bdf557f1a1b" class="idref" href="#91e9aa710642047a93142bdf557f1a1b"><span class="id" title="notation">&quot;</span></a>x := y"  :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Monads.StateTransformerMonad.html#CAss"><span class="id" title="constructor">CAss</span></a> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">x</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">y</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 85, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>) : <span class="id" title="var">com_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> <a id="313afe74ec81f2da17d8e7bca3b042e7" class="idref" href="#313afe74ec81f2da17d8e7bca3b042e7"><span class="id" title="notation">&quot;</span></a>x ; y" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Monads.StateTransformerMonad.html#CSeq"><span class="id" title="constructor">CSeq</span></a> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 90, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>) : <span class="id" title="var">com_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> <a id=":com:com_scope:'if'_x_'then'_x_'else'_x_'end'" class="idref" href="#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">&quot;</span></a>'if' x 'then' y 'else' z 'end'" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Monads.StateTransformerMonad.html#CIf"><span class="id" title="constructor">CIf</span></a> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 89, <span class="id" title="var">x</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">y</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99, <span class="id" title="var">z</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99) : <span class="id" title="var">com_scope</span>.<br/>

<br/>
</div>

<div class="doc">
We now need two functions that allow us to interact with states: 
<ul class="doclist">
<li> the function <span class="inlinecode"><a class="idref" href="Monads.StateTransformerMonad.html#block"><span class="id" title="definition">block</span></a></span>: the call <span class="inlinecode"><a class="idref" href="Monads.StateTransformerMonad.html#block"><span class="id" title="definition">block</span></a></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> creates a new state with all locations initialised to <span class="inlinecode"><span class="id" title="var">n</span></span>,
 applies monad <span class="inlinecode"><span class="id" title="var">m</span></span> to this initial state to yield value <span class="inlinecode"><span class="id" title="var">a</span></span> and final state <span class="inlinecode"><span class="id" title="var">x</span></span>, deallocates the array, and returns <span class="inlinecode"><span class="id" title="var">a</span></span>.

</li>
<li> the function <span class="inlinecode"><a class="idref" href="Monads.StateTransformerMonad.html#fetch"><span class="id" title="definition">fetch</span></a></span>: the call <span class="inlinecode"><a class="idref" href="Monads.StateTransformerMonad.html#fetch"><span class="id" title="definition">fetch</span></a></span> <span class="inlinecode"><span class="id" title="var">x</span></span> returns the value at index <span class="inlinecode"><span class="id" title="var">x</span></span> (indices in our case are just strings)
 in the current state, and leaves the state unchanged.

</li>
<li> the function <span class="inlinecode"><span class="id" title="var">assing</span></span>: the call <span class="inlinecode"><a class="idref" href="Monads.StateTransformerMonad.html#assign"><span class="id" title="definition">assign</span></a></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> returns the empty value <span class="inlinecode">()</span>,
 and updates the state so that index <span class="inlinecode"><span class="id" title="var">x</span></span> contains value <span class="inlinecode"><span class="id" title="var">n</span></span>.

</li>
</ul>
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="block" class="idref" href="#block"><span class="id" title="definition">block</span></a>{<a id="A:64" class="idref" href="#A:64"><span class="id" title="binder">A</span></a>:<span class="id" title="keyword">Type</span>} (<a id="n:65" class="idref" href="#n:65"><span class="id" title="binder">n</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="m:66" class="idref" href="#m:66"><span class="id" title="binder">m</span></a>: <a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#A:64"><span class="id" title="variable">A</span></a>): <a class="idref" href="Monads.StateTransformerMonad.html#A:64"><span class="id" title="variable">A</span></a> :=<br/>
<span class="id" title="keyword">let</span> (<a id="a:67" class="idref" href="#a:67"><span class="id" title="binder">a</span></a>,<a id="x:68" class="idref" href="#x:68"><span class="id" title="binder">x</span></a>):= <a class="idref" href="Monads.StateTransformerMonad.html#m:66"><span class="id" title="variable">m</span></a> (<a class="idref" href="Monads.StateTransformerMonad.html#newarray"><span class="id" title="definition">newarray</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#n:65"><span class="id" title="variable">n</span></a>) <span class="id" title="tactic">in</span> <a class="idref" href="Monads.StateTransformerMonad.html#a:67"><span class="id" title="variable">a</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="fetch" class="idref" href="#fetch"><span class="id" title="definition">fetch</span></a> (<a id="x:69" class="idref" href="#x:69"><span class="id" title="binder">x</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) : <a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> := <br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="s:70" class="idref" href="#s:70"><span class="id" title="binder">s</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Monads.StateTransformerMonad.html#s:70"><span class="id" title="variable">s</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#x:69"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#s:70"><span class="id" title="variable">s</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="assign" class="idref" href="#assign"><span class="id" title="definition">assign</span></a> (<a id="x:71" class="idref" href="#x:71"><span class="id" title="binder">x</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) (<a id="n:72" class="idref" href="#n:72"><span class="id" title="binder">n</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a> := <br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="s:73" class="idref" href="#s:73"><span class="id" title="binder">s</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Monads.StateTransformerMonad.html#f5cb26d96fc0400fc3c881290947e554"><span class="id" title="notation">()</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#state_update"><span class="id" title="definition">state_update</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#s:73"><span class="id" title="variable">s</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#x:71"><span class="id" title="variable">x</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#n:72"><span class="id" title="variable">n</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
We first evaluate expressions: evaluation of a term returns a <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a></span> and may access or modify the state.
In fact, evaluation only accesses the state and never alters it. The intepretation, e.g. in the case of 
addition, goes as follows: <span class="inlinecode"><span class="id" title="tactic">eval</span></span> <span class="inlinecode">(&lt;{<span class="id" title="var">a1</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">a2</span>}&gt;)</span> tells you to compute the evaluation of <span class="inlinecode"><span class="id" title="var">a1</span></span>,
bind <span class="inlinecode"><span class="id" title="var">n1</span></span> to the result, then compute the evaluation of <span class="inlinecode"><span class="id" title="var">a2</span></span>, bind <span class="inlinecode"><span class="id" title="var">n1</span></span> to the result, then return <span class="inlinecode"><span class="id" title="var">n1</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">n2</span></span>. 

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a id="eval" class="idref" href="#eval"><span class="id" title="definition">eval</span></a> (<a id="a:74" class="idref" href="#a:74"><span class="id" title="binder">a</span></a> : <a class="idref" href="Monads.StateTransformerMonad.html#exp"><span class="id" title="inductive">exp</span></a>) : <a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Monads.StateTransformerMonad.html#a:74"><span class="id" title="variable">a</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Monads.StateTransformerMonad.html#ANum"><span class="id" title="constructor">ANum</span></a> <span class="id" title="var">n</span>       =&gt; <a class="idref" href="Monads.StateTransformerMonad.html#ret"><span class="id" title="method">ret</span></a> <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Monads.StateTransformerMonad.html#AId"><span class="id" title="constructor">AId</span></a> <span class="id" title="var">x</span>        =&gt; <a class="idref" href="Monads.StateTransformerMonad.html#fetch"><span class="id" title="definition">fetch</span></a> <span class="id" title="var">x</span>                                <br/>
&nbsp;&nbsp;| <a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">&lt;{</span></a><span class="id" title="var">a1</span> <a class="idref" href="Monads.StateTransformerMonad.html#ad27fd091d9c8494ce7e5135135d19a8"><span class="id" title="notation">+</span></a> <span class="id" title="var">a2</span><a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">}&gt;</span></a>  =&gt; <a id="n1:77" class="idref" href="#n1:77"><span class="id" title="binder">n1</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#eval:75"><span class="id" title="definition">eval</span></a> <span class="id" title="var">a1</span> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">;;</span></a> <a id="n2:78" class="idref" href="#n2:78"><span class="id" title="binder">n2</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#eval:75"><span class="id" title="definition">eval</span></a> <span class="id" title="var">a2</span> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">;;</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#ret"><span class="id" title="method">ret</span></a> (<a class="idref" href="Monads.StateTransformerMonad.html#n1:77"><span class="id" title="variable">n1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#n2:78"><span class="id" title="variable">n2</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">&lt;{</span></a><span class="id" title="var">a1</span> <a class="idref" href="Monads.StateTransformerMonad.html#ce85550d97cec68f8ef10237cdcbffd3"><span class="id" title="notation">==</span></a> <span class="id" title="var">a2</span><a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">}&gt;</span></a> =&gt; <a id="n1:79" class="idref" href="#n1:79"><span class="id" title="binder">n1</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#eval:75"><span class="id" title="definition">eval</span></a> <span class="id" title="var">a1</span> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">;;</span></a> <a id="n2:80" class="idref" href="#n2:80"><span class="id" title="binder">n2</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#eval:75"><span class="id" title="definition">eval</span></a> <span class="id" title="var">a2</span> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">;;</span></a> <span class="id" title="keyword">match</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Arith.EqNat.html#beq_nat"><span class="id" title="abbreviation">beq_nat</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#n1:79"><span class="id" title="variable">n1</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#n2:80"><span class="id" title="variable">n2</span></a>) <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>     =&gt; <a class="idref" href="Monads.StateTransformerMonad.html#ret"><span class="id" title="method">ret</span></a> 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>    =&gt; <a class="idref" href="Monads.StateTransformerMonad.html#ret"><span class="id" title="method">ret</span></a> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
We now define execution on commands: note that, as opposed to <span class="inlinecode"><span class="id" title="tactic">eval</span></span>,
execution of a command returns nothing and may access or modify the state. How do we interpret the code 
below? In the case of a sequence of commands, we have that <span class="inlinecode"><a class="idref" href="Monads.StateTransformerMonad.html#exec"><span class="id" title="definition">exec</span></a></span> <span class="inlinecode">&lt;{<span class="id" title="var">c1</span>;</span> <span class="inlinecode"><span class="id" title="var">c2</span>}&gt;</span> tells you to 
compute the execution of <span class="inlinecode"><span class="id" title="var">c1</span></span>, then compute the execution of <span class="inlinecode"><span class="id" title="var">c2</span></span>, then return nothing. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a id="exec" class="idref" href="#exec"><span class="id" title="definition">exec</span></a> (<a id="c:81" class="idref" href="#c:81"><span class="id" title="binder">c</span></a> : <a class="idref" href="Monads.StateTransformerMonad.html#com"><span class="id" title="inductive">com</span></a>) : <a class="idref" href="Monads.StateTransformerMonad.html#state_comp"><span class="id" title="definition">state_comp</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Monads.StateTransformerMonad.html#c:81"><span class="id" title="variable">c</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#:com:com_scope:'skip'"><span class="id" title="notation">skip</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">}&gt;</span></a>                    =&gt; <a class="idref" href="Monads.StateTransformerMonad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#f5cb26d96fc0400fc3c881290947e554"><span class="id" title="notation">()</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">&lt;{</span></a> <span class="id" title="var">x</span> <a class="idref" href="Monads.StateTransformerMonad.html#91e9aa710642047a93142bdf557f1a1b"><span class="id" title="notation">:=</span></a> <span class="id" title="var">a</span> <a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">}&gt;</span></a>                  =&gt; <a id="n:84" class="idref" href="#n:84"><span class="id" title="binder">n</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#eval"><span class="id" title="definition">eval</span></a> <span class="id" title="var">a</span> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">;;</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#assign"><span class="id" title="definition">assign</span></a> <span class="id" title="var">x</span> <a class="idref" href="Monads.StateTransformerMonad.html#n:84"><span class="id" title="variable">n</span></a> <br/>
&nbsp;&nbsp;| <a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">&lt;{</span></a><span class="id" title="var">c1</span><a class="idref" href="Monads.StateTransformerMonad.html#313afe74ec81f2da17d8e7bca3b042e7"><span class="id" title="notation">;</span></a> <span class="id" title="var">c2</span><a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">}&gt;</span></a>                    =&gt; <a id="x:85" class="idref" href="#x:85"><span class="id" title="binder">x</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#exec:82"><span class="id" title="definition">exec</span></a> <span class="id" title="var">c1</span> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">;;</span></a> <a id="y:86" class="idref" href="#y:86"><span class="id" title="binder">y</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#exec:82"><span class="id" title="definition">exec</span></a> <span class="id" title="var">c2</span> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">;;</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#f5cb26d96fc0400fc3c881290947e554"><span class="id" title="notation">()</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">&lt;{</span></a><a class="idref" href="Monads.StateTransformerMonad.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">if</span></a> <span class="id" title="var">a</span> <a class="idref" href="Monads.StateTransformerMonad.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">then</span></a> <span class="id" title="var">c1</span> <a class="idref" href="Monads.StateTransformerMonad.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">else</span></a> <span class="id" title="var">c2</span> <a class="idref" href="Monads.StateTransformerMonad.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">end</span></a><a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">}&gt;</span></a>  =&gt; <a id="n:87" class="idref" href="#n:87"><span class="id" title="binder">n</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#eval"><span class="id" title="definition">eval</span></a> <span class="id" title="var">a</span> <a class="idref" href="Monads.StateTransformerMonad.html#f4c072b7f26484005a9e0c3986ed1f19"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Monads.StateTransformerMonad.html#n:87"><span class="id" title="variable">n</span></a> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; <a class="idref" href="Monads.StateTransformerMonad.html#exec:82"><span class="id" title="definition">exec</span></a> <span class="id" title="var">c1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <a class="idref" href="Monads.StateTransformerMonad.html#exec:82"><span class="id" title="definition">exec</span></a> <span class="id" title="var">c2</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="fact_in_coq" class="idref" href="#fact_in_coq"><span class="id" title="definition">fact_in_coq</span></a> : <a class="idref" href="Monads.StateTransformerMonad.html#com"><span class="id" title="inductive">com</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#Z"><span class="id" title="definition">Z</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#91e9aa710642047a93142bdf557f1a1b"><span class="id" title="notation">:=</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#X"><span class="id" title="definition">X</span></a><a class="idref" href="Monads.StateTransformerMonad.html#313afe74ec81f2da17d8e7bca3b042e7"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Monads.StateTransformerMonad.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#91e9aa710642047a93142bdf557f1a1b"><span class="id" title="notation">:=</span></a> 1<a class="idref" href="Monads.StateTransformerMonad.html#313afe74ec81f2da17d8e7bca3b042e7"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Monads.StateTransformerMonad.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">if</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#Z"><span class="id" title="definition">Z</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#ce85550d97cec68f8ef10237cdcbffd3"><span class="id" title="notation">==</span></a> 0 <a class="idref" href="Monads.StateTransformerMonad.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Monads.StateTransformerMonad.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#91e9aa710642047a93142bdf557f1a1b"><span class="id" title="notation">:=</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#ad27fd091d9c8494ce7e5135135d19a8"><span class="id" title="notation">+</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#Z"><span class="id" title="definition">Z</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Monads.StateTransformerMonad.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Monads.StateTransformerMonad.html#Z"><span class="id" title="definition">Z</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#91e9aa710642047a93142bdf557f1a1b"><span class="id" title="notation">:=</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#Z"><span class="id" title="definition">Z</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#ad27fd091d9c8494ce7e5135135d19a8"><span class="id" title="notation">+</span></a> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Monads.StateTransformerMonad.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">end</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Monads.StateTransformerMonad.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">}&gt;</span></a>.<br/>

<br/>
<span class="id" title="keyword">Compute</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Monads.StateTransformerMonad.html#exec"><span class="id" title="definition">exec</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#fact_in_coq"><span class="id" title="definition">fact_in_coq</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#empty_st"><span class="id" title="definition">empty_st</span></a>) <a class="idref" href="Monads.StateTransformerMonad.html#X"><span class="id" title="definition">X</span></a>.<br/>
<span class="id" title="keyword">Compute</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.13.0/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Monads.StateTransformerMonad.html#exec"><span class="id" title="definition">exec</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#fact_in_coq"><span class="id" title="definition">fact_in_coq</span></a> <a class="idref" href="Monads.StateTransformerMonad.html#empty_st"><span class="id" title="definition">empty_st</span></a>) <a class="idref" href="Monads.StateTransformerMonad.html#Y"><span class="id" title="definition">Y</span></a>.<br/>

<br/>
</div>

<div class="doc">
 From Walker we read: <i>How a functional language may provide in-place array update is an old problem. 
This section has presented a new solution, consisting of two abstract data types with eight operations between them. 
No change to the programming language is required, other than to provide an implementation of these types, 
perhaps as part of the standard prelude. The discovery of such a simple solution comes as a surpise, 
considering the plethora of more elaborate solutions that have been proposed</i>. 
</div>
<div class="code">

<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
